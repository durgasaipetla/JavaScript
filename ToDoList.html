<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple To-Do App</title>
  <style>
    :root{
      --bg:#f4f7fb; --card:#ffffff; --accent:#4f46e5; --muted:#6b7280;
    }
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      margin:0;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:20px;
    }
    .app {
      width:100%;
      max-width:540px;
      background:var(--card);
      padding:20px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(15,23,42,0.08);
    }
    h1{ margin:0 0 12px; font-size:20px; color:#0f172a; }
    .input-row{ display:flex; gap:8px; margin-bottom:12px; }
    input[type="text"]{
      flex:1;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #e6e9ef;
      outline:none;
      font-size:14px;
    }
    button{
      border:0;
      background:var(--accent);
      color:white;
      padding:10px 14px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    .list { margin-top:8px; }
    .task {
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px;
      border-radius:8px;
      border:1px solid #eef2ff;
      margin-bottom:8px;
      background: #fff;
    }
    .task .title {
      flex:1;
      word-break:break-word;
      color:#0f172a;
    }
    .task .title.completed { text-decoration:line-through; color:var(--muted); opacity:0.8; }
    .small-btn{
      background:transparent;
      border:0;
      cursor:pointer;
      padding:6px;
      border-radius:6px;
      color:var(--muted);
    }
    .small-btn:hover { 
      background:#f1f5f9; 
      color:#111827; 
    }
    .meta { font-size:12px; color:var(--muted); margin-top:8px; display:flex; justify-content:space-between; align-items:center; }
    .edit-input{
      width:100%;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid #e6e9ef;
      font-size:14px;
    }
    .filters button { margin-right:8px; background:transparent; color:var(--muted); }
    .filters button.active { color:var(--accent); font-weight:600; }
    @media (max-width:420px){
      .app{ padding:14px; }
      button{ padding:8px 10px; }
    } 
  </style>
</head>
<body>
  <div class="app" aria-live="polite">
    <h1>To-Do List</h1>
    <div class="input-row"> 
      <input id="taskInput" type="text" placeholder="Add a new task and press Enter" />
      <button id="addBtn">Add</button>
    </div>
    <div class="filters" style="margin-bottom:10px;">
      <button data-filter="all" class="active">All</button> 
      <button data-filter="active">Active</button>
      <button data-filter="completed">Completed</button>
      <button id="clearCompleted" style="float:right" class="small-btn">Clear Completed</button>
    </div>

    <div id="list" class="list" role="list"></div>

    <div class="meta">
      <div id="count">0 tasks</div>
      <div>LocalStorage saved âœ”</div>
    </div>
  </div>

  <script>
    // ======= Data Model & Helpers =======
    const STORAGE_KEY = "simple_todo_tasks_v1";

    function uid() {
      return Date.now().toString(36) + Math.random().toString(36).slice(2,8);
    }

    function loadTasks() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch(e) {
        console.error("Failed to load tasks:", e);
        return [];
      }
    }

    function saveTasks(tasks) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      } catch(e) {
        console.error("Failed to save tasks:", e);
      }
    }

    // ======= App State =======
    let tasks = loadTasks();            // array of {id, title, completed, createdAt}
    let filter = "all";                // all | active | completed

    // ======= UI Elements =======
    const taskInput = document.getElementById("taskInput");
    const addBtn = document.getElementById("addBtn");
    const listDiv = document.getElementById("list");
    const countDiv = document.getElementById("count");
    const filterButtons = document.querySelectorAll('.filters button[data-filter]');
    const clearCompletedBtn = document.getElementById("clearCompleted");

    // ======= Rendering =======
    function render() {
      // Apply filter
      const visible = tasks.filter(t => {
        if (filter === "active") return !t.completed;
        if (filter === "completed") return t.completed;
        return true;
      });

      // Update list in DOM
      listDiv.innerHTML = "";
      visible.forEach(task => {
        const item = document.createElement("div");
        item.className = "task";
        item.setAttribute("role","listitem");
        item.dataset.id = task.id;

        // checkbox
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!task.completed;
        cb.addEventListener("change", () => toggleComplete(task.id));
        item.appendChild(cb);

        // title / edit input
        const titleWrapper = document.createElement("div");
        titleWrapper.style.flex = "1";

        const title = document.createElement("div");
        title.className = "title" + (task.completed ? " completed" : "");
        title.textContent = task.title;
        titleWrapper.appendChild(title);

        // double click to edit
        title.addEventListener("dblclick", () => startEditing(task.id, titleWrapper, task.title));

        item.appendChild(titleWrapper);

        // edit button
        const editBtn = document.createElement("button");
        editBtn.className = "small-btn";
        editBtn.innerText = "Edit";
        editBtn.title = "Edit";
        editBtn.addEventListener("click", () => startEditing(task.id, titleWrapper, task.title));
        item.appendChild(editBtn);

        // delete button
        const delBtn = document.createElement("button");
        delBtn.className = "small-btn";
        delBtn.innerText = "Delete";
        delBtn.title = "Delete";
        delBtn.addEventListener("click", () => deleteTask(task.id));
        item.appendChild(delBtn);

        listDiv.appendChild(item);
      });

      // Update count
      const total = tasks.length;
      const activeCount = tasks.filter(t => !t.completed).length;
      countDiv.textContent = `${activeCount} active / ${total} total`;
      
      // Update filter button UI
      filterButtons.forEach(b => b.classList.toggle('active', b.dataset.filter === filter));
    }

    // ======= Actions =======
    function addTask(text) {
      const trimmed = text.trim();
      if (!trimmed) return;
      const newTask = { id: uid(), title: trimmed, completed: false, createdAt: Date.now() };
      tasks.unshift(newTask); // newest on top
      saveTasks(tasks);
      render();
    }

    function deleteTask(id) {
      tasks = tasks.filter(t => t.id !== id);
      saveTasks(tasks);
      render();
    }

    function toggleComplete(id) {
      tasks = tasks.map(t => t.id === id ? {...t, completed: !t.completed} : t);
      saveTasks(tasks);
      render();
    }

    function startEditing(id, container, currentTitle) {
      container.innerHTML = ""; // replace with input + save/cancel
      const input = document.createElement("input");
      input.className = "edit-input";
      input.value = currentTitle;
      container.appendChild(input);
      input.focus();
      input.select();

      // Save / cancel helpers
      function commit() {
        const newVal = input.value.trim();
        if (newVal) {
          tasks = tasks.map(t => t.id === id ? {...t, title: newVal} : t);
          saveTasks(tasks);
        }
        render();
      }
      function cancel() { render(); }

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") commit();
        else if (e.key === "Escape") cancel();
      });

      // On blur, commit changes (common UX)
      input.addEventListener("blur", commit);
    }

    function clearCompleted() {
      tasks = tasks.filter(t => !t.completed);
      saveTasks(tasks);
      render();
    }

    // ======= Event Listeners =======
    addBtn.addEventListener("click", () => {
      addTask(taskInput.value);
      taskInput.value = "";
      taskInput.focus();
    });

    taskInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        addTask(taskInput.value);
        taskInput.value = "";
      }
    });

    filterButtons.forEach(b => {
      b.addEventListener("click", () => {
        filter = b.dataset.filter;
        render();
      });
    });

    clearCompletedBtn.addEventListener("click", clearCompleted);

    // Initial render
    render();
  </script>
</body>
</html>
